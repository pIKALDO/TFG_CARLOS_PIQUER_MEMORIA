% Contenidos del capítulo.
% Las secciones presentadas son orientativas y no representan
% necesariamente la organización que debe tener este capítulo.

\section{Diagramas de análisis}

\subsection{Diagrama de casos de uso}

Para representar las interacciones entre los diferentes actores del sistema se ha elaborado el diagrama de casos de uso mostrado en la Figura~\ref{fig:casos_uso}. 
Este permite visualizar de forma general las funcionalidades principales y la relación entre el cliente, el administrador y el agente automatizador \textit{n8n}.

\begin{figure}[H]
    \centering
    \includegraphics[height=1\textwidth, width=1.05\textwidth, keepaspectratio]{figs/Caso_de uso_def.png}
    \caption{Diagrama de casos de uso del sistema.}
    \label{fig:casos_uso}
\end{figure}
\clearpage

\subsection{Diagrama de clases de análisis}

En la Figura~\ref{fig:clases_analisis} se muestra el \textbf{diagrama de clases de análisis} del sistema. 
Este modelo conceptual identifica las principales entidades que intervienen en el dominio de la aplicación, 
así como las relaciones que existen entre ellas. 
El cliente dispone de un carrito y puede realizar múltiples pedidos, 
cada uno de los cuales está asociado a un pago y a varios productos. 
Además, el cliente puede almacenar varias direcciones de envío, 
y los productos se agrupan dentro de categorías. 
El diagrama abstrae los detalles técnicos y se centra únicamente en los conceptos del negocio, 
sirviendo como base para el posterior diagrama de clases de diseño.

\begin{figure}[H]
    \centering
    \includegraphics[width=0.85\textwidth]{figs/CasosdeUsoAnalisis.png}
    \caption{Diagrama de clases de análisis del sistema.}
    \label{fig:clases_analisis}
\end{figure}
\clearpage

\subsection{Diagrama de secuencia general del sistema (DSGS)}

La Figura~\ref{fig:dsgs} muestra el \textbf{diagrama de secuencia general del sistema (DSGS)}, 
que representa de forma dinámica las interacciones entre los principales actores externos 
y la \textit{WebApp}. En él se detalla el flujo completo de una compra, 
desde el inicio de sesión del cliente, la selección de productos y la realización del pedido, 
hasta la comunicación con la pasarela de pago \textit{Stripe} 
y la notificación del resultado a la plataforma de automatización \textit{n8n}. 
El diagrama también incluye un flujo alternativo en el que se muestra el manejo de un posible error de pago. 
Este modelo complementa al diagrama de casos de uso al ofrecer una visión temporal del comportamiento global del sistema.

\begin{figure}[H]
    \centering
    \includegraphics[width=0.9\textwidth]{figs/DSGS.png}
    \caption{Diagrama de secuencia general del sistema (DSGS).}
    \label{fig:dsgs}
\end{figure}
\subsubsection{DSGS-00 Diagrama de secuencia general del sistema}

\begin{table}[H]
\centering
\small
\begin{tabular}{|m{0.28\textwidth}|m{0.65\textwidth}|}
\hline
\textbf{Nombre} & DSGS-00 Diagrama de secuencia general del sistema \\ \hline

\textbf{Actor(es)} & Cliente, WebApp, Stripe, n8n \\ \hline

\textbf{Descripción} &
Representa el flujo global del sistema durante el proceso de compra: inicio de sesión del cliente,
gestión del carrito, procesamiento del pago a través de Stripe y notificación del resultado a n8n,
incluyendo un flujo alternativo en caso de error de pago. \\ \hline

\textbf{Precondiciones} &
El cliente debe tener acceso a la WebApp y existir conexión con Stripe y n8n. \\ \hline

\textbf{Postcondiciones} &
El pedido queda confirmado o rechazado, y n8n recibe la notificación para ejecutar las tareas automáticas. \\ \hline

\textbf{Flujo principal} &
1. El cliente inicia sesión. \newline
2. Añade productos al carrito. \newline
3. Realiza el pedido. \newline
4. La WebApp envía el pago a Stripe. \newline
5. Stripe confirma el pago. \newline
6. La WebApp confirma el pedido. \newline
7. La WebApp notifica a n8n para ejecutar tareas post-compra. \\ \hline

\textbf{Flujos alternativos} &
4.a Stripe devuelve un error → la WebApp muestra el fallo al cliente. \\ \hline

\textbf{Requisitos funcionales relacionados} &
RF-01, RF-02, RF-04, RF-06 \\ \hline
\end{tabular}
\caption{Especificación del flujo DSGS-00 — Diagrama de secuencia del sistema.}
\end{table}

\clearpage



