% Contenidos del capítulo.
% Las secciones presentadas son orientativas y no representan
% necesariamente la organización que debe tener este capítulo.

% Diagramas de clases, de secuencia, de despliegue, diseño de
% pantallas, etc


En este capítulo se presenta el proceso de diseño del sistema desarrollado, que abarca tanto la definición de la arquitectura general como los distintos diagramas UML que describen la estructura y el comportamiento de la aplicación. Finalmente, se incluye el diseño de la base de datos, que servirá como soporte a la implementación posterior.

\section{Arquitectura general del sistema}

El sistema se basa en una arquitectura de tres capas que facilita la separación de responsabilidades y la escalabilidad del proyecto:

\begin{itemize}
    \item \textbf{Frontend:} desarrollado con un framework moderno Angular, encargado de la interacción con el usuario y la comunicación con el backend mediante peticiones HTTP.
    \item \textbf{Backend:} implementado con \textit{Spring Boot}, que gestiona la lógica de negocio, las operaciones CRUD y la conexión con la base de datos.
    \item \textbf{Base de datos:} gestionada con el motor \textit{MySQL}, donde se almacenan las entidades principales del sistema.
\end{itemize}

Además, el sistema integra un agente automatizador \textit{n8n} encargado de tareas como el envío de notificaciones post-compra, la generación automática de facturas o la detección de carritos abandonados.  
Esta arquitectura modular permite una comunicación fluida entre componentes y facilita la futura ampliación del sistema.

\section{Diagramas UML}

Los diagramas UML se han elaborado con la herramienta \textit{Visual Paradigm} para representar de forma visual los componentes y sus interacciones. Se incluyen diagramas de casos de uso, clases y secuencia.

\subsection{Diagrama de clases}

En la Figura~\ref{fig:clases} se muestra el diagrama de clases que define la estructura interna del sistema, las entidades principales y sus relaciones.  
Entre las clases más destacadas se encuentran:

\begin{itemize}
    \item \textbf{Usuario:} almacena la información del cliente o administrador.
    \item \textbf{Producto:} contiene los datos de los artículos disponibles.
    \item \textbf{Carrito} y \textbf{CarritoItems:} gestionan los productos añadidos por cada usuario.
    \item \textbf{Pedido}, \textbf{Pago} y \textbf{Factura:} representan el flujo de compra y facturación.
\end{itemize}

\begin{figure}[H]
    \centering
    \includegraphics[height=1\textwidth, width=1.05\textwidth, keepaspectratio]{figs/clasesdef.png}
    \caption{Diagrama de clases del sistema}
    \label{fig:clases}
\end{figure}
\clearpage
\subsection{Diagramas de secuencia}

Los diagramas de secuencia reflejan los flujos de interacción entre los distintos componentes del sistema en diferentes escenarios funcionales. Estos esquemas permiten entender cómo se comunican los distintos servicios y agentes en cada proceso clave del sistema.

\paragraph{Gestión de carrito}

En este diagrama se representa el flujo de interacción entre el cliente, la aplicación web y los servicios del catálogo y del carrito.  
El usuario puede añadir, modificar o eliminar productos del carrito, y el sistema actualiza los datos en tiempo real mostrando la información correspondiente a cada producto.

\begin{figure}[H]
    \centering
    \includegraphics[width=0.9\textwidth]{figs/Gestiondecarrito.jpg}
    \caption{Diagrama de secuencia — gestión del carrito}
    \label{fig:carrito}
\end{figure}
\clearpage

\paragraph{Compra estándar}

A continuación, se muestra el flujo completo del proceso de compra.  
Incluye la autenticación del usuario, la creación del checkout, la comunicación con el servicio de pago \textit{Stripe} y la confirmación del pedido.  
También se representa la respuesta automatizada del agente \textit{n8n} para confirmar la compra, descontar el stock y generar la factura.

\begin{figure}[H]
    \centering
    \includegraphics[width=0.95\textwidth]{figs/Compra_estandar_1.png}
    \caption{Diagrama de secuencia — parte 1: autenticación y carrito}
    \label{fig:compra1}
\end{figure}

\begin{figure}[H]
    \centering
    \includegraphics[width=0.95\textwidth]{figs/Compra_estandar_2.png}
    \caption{Diagrama de secuencia — parte 2: proceso de checkout y confirmación}
    \label{fig:compra2}
\end{figure}

\begin{figure}[H]
    \centering
    \includegraphics[width=0.95\textwidth]{figs/Compra_estandar_3.png}
    \caption{Diagrama de secuencia — parte 3: flujo alternativo de pago fallido}
    \label{fig:compra3}
\end{figure}


\paragraph{Generación de factura}

Este diagrama muestra el proceso automatizado de creación de facturas tras la confirmación de un pedido.  
Una vez validado el pago, el sistema genera el documento asociado y lo envía al cliente mediante el agente \textit{n8n}, garantizando así un flujo de trabajo totalmente automatizado.

\begin{figure}[H]
    \centering
    \includegraphics[width=0.9\textwidth]{figs/Generaciondefactura.jpg}
    \caption{Diagrama de secuencia — generación de factura}
    \label{fig:factura}
\end{figure}
\clearpage

\paragraph{Abandono de carrito}

Este diagrama refleja el funcionamiento del proceso de detección y eliminación de carritos inactivos.  
Si un usuario añade productos pero no completa la compra en un tiempo determinado, el sistema marca el carrito como abandonado y libera los productos reservados.

\begin{figure}[H]
    \centering
    \includegraphics[width=0.9\textwidth]{figs/Abandonodecarrito.jpg}
    \caption{Diagrama de secuencia — abandono de carrito}
    \label{fig:abandono}
\end{figure}
\clearpage

\paragraph{Bajo stock}

Por último, se representa el proceso de notificación de stock bajo.  
Cuando el inventario de un producto alcanza un umbral mínimo, el sistema ejecuta una tarea automatizada que envía un aviso al administrador mediante el agente \textit{n8n}, permitiendo reponer el producto a tiempo.

\begin{figure}[H]
    \centering
    \includegraphics[width=0.9\textwidth]{figs/Bajostock.jpg}
    \caption{Diagrama de secuencia — notificación de bajo stock}
    \label{fig:bajo_stock}
\end{figure}

\section{Diseño de la base de datos}

El diseño de la base de datos se llevó a cabo inicialmente mediante \textit{dbdiagram.io}, para definir de manera visual las entidades, sus atributos y relaciones.  
Posteriormente, el modelo se validó e implementó en \textit{MySQL Workbench}, comprobando su coherencia con el backend en \textit{Spring Boot}.

\subsection{Modelo entidad–relación}

El modelo E/R del sistema representa las entidades principales (\textit{usuarios, productos, carritos, pedidos, pagos, facturas}) y las relaciones entre ellas.  
Estas relaciones garantizan la integridad referencial mediante el uso de claves primarias, foráneas y restricciones de unicidad.
\clearpage  

\subsection{Modelo relacional y prototipo inicial}

El modelo relacional resultante se compone de tablas como \texttt{usuarios}, \texttt{productos}, \texttt{carritos}, \texttt{carrito\_items}, \texttt{pedidos}, \texttt{pagos} y \texttt{facturas}.  
La Figura~\ref{fig:prototipoBD} muestra el esquema final diseñado.

\begin{figure}[H]
    \centering
    \includegraphics[width=0.95\textwidth]{figs/prototipoBD.png}
    \caption{Prototipo de la base de datos relacional}
    \label{fig:prototipoBD}
\end{figure} 
\clearpage
\section{Diseño de la interfaz de usuario}

Además del diseño lógico y técnico del sistema, se ha desarrollado un prototipo visual que representa la estructura y apariencia de la aplicación web. 
Este diseño tiene como objetivo definir la disposición de los elementos de la interfaz, mejorar la experiencia de usuario y servir como guía en la fase de implementación del \textit{frontend}.

\subsection{Prototipo de la página de inicio}

La Figura~\ref{fig:prototipo_inicio} muestra el prototipo correspondiente a la página principal de la aplicación, diseñado con la herramienta \textit{Pencil Project}. 
La interfaz se ha elaborado siguiendo criterios de claridad, jerarquía visual y coherencia con el resto del sistema.

En la parte superior se encuentra la barra de navegación, que incluye el logotipo de la tienda, el buscador, las secciones principales y el acceso al carrito. 
A continuación, se muestra un banner promocional con un mensaje destacado y un botón de acción. 
Debajo se encuentran las categorías principales de productos, seguidas de una sección con artículos destacados y, finalmente, un pie de página con la información corporativa y enlaces a redes sociales.

\begin{figure}[H]
    \centering
    \includegraphics[width=\textwidth, keepaspectratio]{figs/prototipoinicio.png}
    \caption{Prototipo de la página de inicio de la aplicación web.}
    \label{fig:prototipo_inicio}
\end{figure}
\clearpage
\subsection{Prototipo del catálogo de productos}

La Figura~\ref{fig:prototipo_catalogo} muestra el prototipo de la vista de catálogo, en la que el usuario puede explorar el inventario completo. 
La interfaz mantiene la coherencia visual con la página de inicio (mismo encabezado y pie de página) e incorpora una barra de filtros en la parte superior con búsqueda por texto, selección de categoría, rango de precio, opción de disponibilidad (\textit{En stock}) y un control de \textit{Ordenar por}. 
Bajo dicha barra se presenta una rejilla de productos (tarjetas con imagen, nombre, precio y botón \textit{Añadir al carrito}) organizada en filas y columnas para facilitar el escaneo visual.

\begin{figure}[H]
    \centering
    \includegraphics[width=\textwidth, keepaspectratio]{figs/catalogo_de_productos.png}
    \caption{Prototipo del catálogo de productos con barra de filtros y rejilla de artículos.}
    \label{fig:prototipo_catalogo}
\end{figure}
\clearpage
\subsection{Prototipo del carrito de compra}

La Figura~\ref{fig:prototipo_carrito} muestra el prototipo de la vista de carrito. 
La interfaz mantiene la coherencia visual con el resto de pantallas (mismo encabezado y pie) y presenta una \textit{tabla de líneas} donde se visualiza cada producto añadido con su imagen, nombre, precio unitario, selector de cantidad y subtotal, además de la acción de eliminar. 
En la parte inferior se destaca el importe \textbf{Total} y se incluyen los botones de navegación principales: \textit{Seguir comprando} y \textit{Finalizar compra}.

\begin{figure}[H]
    \centering
    \includegraphics[width=\textwidth, keepaspectratio]{\string figs/carrito_de_compra.png}
    \caption{Prototipo del carrito de compra con líneas de producto, total y acciones principales.}
    \label{fig:prototipo_carrito}
\end{figure}
\clearpage

\subsection{Prototipo del proceso de pago (\textit{Checkout})}

La Figura~\ref{fig:prototipo_checkout} muestra el prototipo correspondiente a la vista de pago del sistema. 
Esta pantalla representa la fase final del proceso de compra y mantiene la coherencia visual con el resto de interfaces, reutilizando la barra de navegación superior y el pie de página.

La interfaz se estructura en distintos bloques claramente diferenciados: \textbf{Datos personales}, \textbf{Dirección de envío}, \textbf{Método de pago} y \textbf{Tarjeta}. 
Cada sección incluye los campos necesarios para introducir la información correspondiente, priorizando la claridad y la usabilidad. 
En la parte inferior derecha se presenta el \textbf{resumen del pedido}, donde se muestran los productos seleccionados, el desglose de precios (subtotal, envío y total) y las acciones finales: 
\textit{Volver al carrito} y \textit{Confirmar pedido}.

\begin{figure}[H]
    \centering
    \includegraphics[width=\textwidth, keepaspectratio]{\string figs/checkout_pago.png}
    \caption{Prototipo del proceso de pago con formularios y resumen del pedido.}
    \label{fig:prototipo_checkout}
\end{figure}